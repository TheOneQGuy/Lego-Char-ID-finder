
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Character & Tint ID finder</title>
  <style>
    body { font-family: sans-serif; max-width:600px; margin:2em auto; }
    section { border:1px solid #ccc; padding:1em; margin-bottom:2em; }
    input[type="text"], textarea { width:100%; font-size:1em; margin:0.5em 0; }
    button { width:100%; font-size:1em; margin:0.5em 0; }
    pre { background:#f4f4f4; padding:1em; white-space:pre-wrap; }

    .dropdown-content { display:none; padding:0.5em; border:1px solid #aaa; margin:0.5em 0; }
    .dropdown.open .dropdown-content { display:block; }

    .toggle-btn {
      display:flex; justify-content:space-between; align-items:center;
      width:100%; background:none; border:1px solid #ccc;
      padding:0.5em; font-size:1em; cursor:pointer;
    }
    .triangle { display:inline-block; transform: rotate(180deg); }
    .dropdown.open .triangle { transform: rotate(0deg); }

    .small-color { width:3em; height:2em; padding:0; border:none; vertical-align:middle; }
    input[type=color] {
      -webkit-appearance: none; border: none; padding: 0;
      width:3em; height:2em;
    }
    input[type=color]::-webkit-color-swatch-wrapper { padding:0; }
    input[type=color]::-webkit-color-swatch { border:1px solid gray; }

    input[type=file] { width:100%; margin:0.5em 0; }
    #imageCanvas {
      display:block; margin:0.5em auto;
      border:1px solid #ccc; cursor:crosshair;
    }
  </style>
</head>
<body>

<section>
  <h2>Characters IDs</h2>
  <label>Name → ID</label>
  <input id="charName" type="text" placeholder="e.g. IRONMANMARK6" />
  <button onclick="charNameToID()">Get ID</button>
  <pre id="charNameOut"></pre>
  <hr/>
  <label>ID → Name (requires list)</label>
  <input id="charID" type="text" placeholder="e.g. -2138279224" />
  <textarea id="charList" rows="4" placeholder="One name per line…"></textarea>
  <button onclick="charIDToName()">Find Matches</button>
  <pre id="charIDOut"></pre>
</section>

<section>
  <h2>Color (Tint) IDs</h2>
  <label>Color hex code → Tint ID</label>
  <input id="colName" type="text" placeholder="#RRGGBB" />
  <div class="dropdown" id="pickerDropdown">
    <button class="toggle-btn" onclick="toggleDropdown()">
      Advanced picker <span class="triangle">⌵</span>
    </button>
    <div class="dropdown-content">
      <label>Color picker:</label><br/>
      <input type="color" id="colorPicker" class="small-color"
             onchange="colName.value=this.value; colNameToID()" /><br/>
      <label>Image eyedropper:</label><br/>
      <input type="file" id="imageLoader" accept=".dds,.DDS,.tex,.TEX,image/*" />
      <canvas id="imageCanvas"></canvas>
    </div>
  </div>
  <button onclick="colNameToID()">Get Tint ID</button>
  <pre id="colNameOut"></pre>
  <hr/>
  <label>ID → Hex code + preview</label>
  <input id="colID" type="text" placeholder="e.g. -5744098" />
  <button onclick="colIDToHex()">Show Hex & Preview</button>
  <pre id="colIDOut"></pre>
</section>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.149.0/build/three.module.js",
    "three/examples/jsm/loaders/DDSLoader.js": "https://unpkg.com/three@0.149.0/examples/jsm/loaders/DDSLoader.js"
  }
}
</script>

<script type="module">
  import * as THREE from 'three';
  import { DDSLoader } from 'three/examples/jsm/loaders/DDSLoader.js';

  function fnv1(name) {
    let h = 0x811c9dc5 >>> 0;
    for (let c of name.trim().toUpperCase()) {
      h = Math.imul(h, 0x01000193) >>> 0;
      h ^= c.charCodeAt(0);
    }
    return (h & 0x80000000) ? h - 0x100000000 : h;
  }

  window.charNameToID = () => {
    const n = document.getElementById('charName').value;
    document.getElementById('charNameOut').textContent = n ? `${n.toUpperCase()} = ${fnv1(n)}` : 'Enter a name.';
  };

  window.charIDToName = () => {
    const raw = document.getElementById('charID').value.trim();
    const out = document.getElementById('charIDOut');
    if (!/^-?\d+$/.test(raw)) {
      out.textContent = 'Enter valid ID.'; return;
    }
    const target = parseInt(raw,10);
    const candidates = document.getElementById('charList').value.split('\n').map(x=>x.trim()).filter(Boolean);
    const hits = candidates.filter(x=>fnv1(x)===target);
    out.textContent = hits.length ? hits.join('\n') : 'No matches found.';
  };

  window.toggleDropdown = () => {
    document.getElementById('pickerDropdown').classList.toggle('open');
  };

  window.colNameToID = () => {
    const inp = document.getElementById('colName').value.trim();
    const name = inp.startsWith('#') ? inp : '#' + inp;
    if (!/^#?[0-9A-Fa-f]{6}$/.test(name)) {
      document.getElementById('colNameOut').textContent = 'Enter #RRGGBB'; return;
    }
    const [r,g,b] = [1,3,5].map(i=>parseInt(name.slice(i,i+2),16));
    const u = (((255<<24)|(b<<16)|(g<<8)|r)>>>0);
    const s = (u & 0x80000000)? u-0x100000000 : u;
    document.getElementById('colNameOut').textContent = `${name.toUpperCase()} = ${s}`;
  };

  window.colIDToHex = () => {
    const raw = document.getElementById('colID').value.trim();
    if (!/^-?\d+$/.test(raw)) {
      document.getElementById('colIDOut').textContent = 'Enter valid ID.'; return;
    }
    const signed = parseInt(raw,10), u = signed>>>0;
    const full = u.toString(16).toUpperCase().padStart(8,'0');
    const hex  = full.slice(6)+full.slice(4,6)+full.slice(2,4);
    document.getElementById('colIDOut').innerHTML =
      `${signed} = #${hex}\nPreview: <input id="swatch" type="color" class="small-color" disabled>`;
    document.getElementById('swatch').value = `#${hex}`;
  };

  const ddsLoader = new DDSLoader();
  document.getElementById('imageLoader').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;
    const ext = file.name.split('.').pop().toLowerCase();
    const buf = await file.arrayBuffer();
    let imageData, w, h;

    if (ext==='dds'||ext==='tex') {
      const tex = ddsLoader.parse(buf, true);
      w = tex.image.width; h = tex.image.height;
      imageData = new ImageData(new Uint8ClampedArray(tex.image.data), w, h);
    } else {
      const img = new Image();
      img.src = URL.createObjectURL(file);
      await img.decode();
      const off = document.createElement('canvas');
      off.width = img.width; off.height = img.height;
      off.getContext('2d').drawImage(img,0,0);
      w = off.width; h = off.height;
      imageData = off.getContext('2d').getImageData(0,0,w,h);
    }

    const c = document.getElementById('imageCanvas'), ctx = c.getContext('2d'),
          maxDim = document.getElementById('colName').clientWidth*0.66,
          scale = Math.min(maxDim/w, maxDim/h,1);
    c.width = w*scale; c.height = h*scale;

    const off2 = document.createElement('canvas');
    off2.width = w; off2.height = h;
    off2.getContext('2d').putImageData(imageData,0,0);
    ctx.drawImage(off2,0,0,c.width,c.height);
  });

  document.getElementById('imageCanvas').addEventListener('click', e => {
    const ctx = imageCanvas.getContext('2d'),
          rect = imageCanvas.getBoundingClientRect(),
          x = e.clientX-rect.left, y = e.clientY-rect.top,
          [r,g,b] = ctx.getImageData(x,y,1,1).data;
    const hex = '#' + [r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
    colName.value=hex; colNameToID();
  });
</script>
</body>
</html>
