<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CUSTOMISERPARTS_AUTOGENERATED Character name finder</title>
  <style>
    body { font-family: sans-serif; max-width:600px; margin:2em auto; }
    section { border:1px solid #ccc; padding:1em; margin-bottom:2em; }
    input[type="text"], textarea { width:100%; font-size:1em; margin:0.5em 0; }
    button { width:100%; font-size:1em; margin:0.5em 0; }
    pre { background:#f4f4f4; padding:1em; white-space:pre-wrap; }

    /* Dropdown styling */
    .dropdown-content { display:none; padding:0.5em; border:1px solid #aaa; margin:0.5em 0; }
    .dropdown.open .dropdown-content { display:block; }

    /* Toggle button and triangle */
    .toggle-btn {
      display:flex; justify-content:space-between; align-items:center;
      width:100%; background:none; border:1px solid #ccc;
      padding:0.5em; font-size:1em; cursor:pointer;
    }
    .triangle { display:inline-block; transform: rotate(180deg); }
    .dropdown.open .triangle { transform: rotate(0deg); }

    /* Color picker & preview swatch */
    .small-color {
      width:3em; height2em; padding:0; border:none;
      vertical-align:middle;
    }
    /* revert to browser default styling for color inputs */
    input[type=color] {
      -webkit-appearance: none;
      border: none;
      padding: 0;
      width:3em; height:2em;
    }
    input[type=color]::-webkit-color-swatch-wrapper {
      padding:0;
    }
    input[type=color]::-webkit-color-swatch {
      border:1px solid gray;
      /* middle and inner border are native to the OS/browser picker */
    }

    input[type=file] { width:100%; margin:0.5em 0; }
    #imageCanvas {
      display:block; margin:0.5em auto;
      border:1px solid #ccc; cursor:crosshair;
    }
    #cc { display:none; }
  </style>
</head>
<body>

  <!-- CHARACTER TOOL -->
  <section>
    <h2>Characters IDs</h2>
    <label>Name → ID</label>
    <input id="charName" type="text" placeholder="e.g. IRONMANMARK6" />
    <button onclick="charNameToID()">Get ID</button>
    <pre id="charNameOut"></pre>
    <hr/>
    <label>ID → Name (This requires a list of possible names.)</label>
    <input id="charID" type="text" placeholder="e.g. -2138279224" />
    <textarea id="charList" rows="4" placeholder="Paste one name per line…"></textarea>
    <button onclick="charIDToName()">Find Matches</button>
    <pre id="charIDOut"></pre>
  </section>

  <!-- COLOR TOOL -->
  <section>
    <h2>Color (Tint) IDs</h2>
    <label>Color hex code → Tint ID</label>
    <input id="colName" type="text" placeholder="#RRGGBB" />

    <div class="dropdown" id="pickerDropdown">
      <button class="toggle-btn" onclick="toggleDropdown()">
        Advanced picker <span class="triangle">⌵</span>
      </button>
      <div class="dropdown-content">
        <label for="colorPicker">Color picker:</label><br/>
        <input type="color" id="colorPicker" class="small-color"
               onchange="colName.value=this.value; colNameToID()" /><br/>
<!-- replace your file‐input and script code with this: -->
<label for="imageLoader">Image eyedropper:</label><br/>
<input type="file" id="imageLoader" accept=".dds,.DDS,.tex,.TEX,image/*" />

<!-- include a DDS loader before your main script: -->
<script type="module">
  import { DDSLoader } from 'https://unpkg.com/three/examples/jsm/loaders/DDSLoader.js';

  const loader = new DDSLoader();

  document.getElementById('imageLoader').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;
    const ext = file.name.split('.').pop().toLowerCase();
    const isDDS = ext === 'dds' || ext === 'tex';

    const arrayBuffer = await file.arrayBuffer();
    let imageData;

    if (isDDS) {
      // Decode DDS to a DataTexture
      const texture = loader.parse(arrayBuffer, true);
      // texture.image.width/height, texture.image.data (Uint8Array in RGBA)
      const { width, height } = texture.image;
      imageData = new ImageData(
        new Uint8ClampedArray(texture.image.data),
        width, height
      );
    } else {
      // Fallback for PNG/JPG/etc.
      const img = new Image();
      img.src = URL.createObjectURL(file);
      await img.decode();
      const canvas = document.createElement('canvas');
      canvas.width = img.width; canvas.height = img.height;
      canvas.getContext('2d').drawImage(img, 0, 0);
      imageData = canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);
    }

    // Draw into your onscreen canvas
    const c = document.getElementById('imageCanvas');
    const ctx = c.getContext('2d');
    // scale to fit 2/3 size as before
    const maxDim = document.getElementById('colName').clientWidth * 0.66;
    const scale = Math.min(maxDim/imageData.width, maxDim/imageData.height, 1);
    c.width  = imageData.width * scale;
    c.height = imageData.height * scale;
    // putImageData doesn’t scale, so use an offscreen canvas
    const off = document.createElement('canvas');
    off.width = imageData.width; off.height = imageData.height;
    off.getContext('2d').putImageData(imageData, 0,0);
    ctx.drawImage(off, 0, 0, c.width, c.height);
  });
</script>

        <canvas id="imageCanvas"></canvas>
      </div>
    </div>

    <button onclick="colNameToID()">Get Tint ID</button>
    <pre id="colNameOut"></pre>

    <hr/>

    <label>ID → Hex code + preview</label>
    <input id="colID" type="text" placeholder="e.g. -5744098" />
    <button onclick="colIDToHex()">Show Hex & Preview</button>
    <pre id="colIDOut"></pre>
  </section>

  <canvas id="cc"></canvas>

  <script>
    function fnv1(name) {
      let h = 0x811c9dc5 >>> 0;
      const s = name.trim().toUpperCase();
      for (let i=0; i<s.length; i++) {
        h = Math.imul(h, 0x01000193) >>> 0;
        h ^= s.charCodeAt(i);
      }
      return (h & 0x80000000)? h - 0x100000000 : h;
    }

    // Characters
    function charNameToID(){
      const n=document.getElementById('charName').value;
      charNameOut.textContent=n
        ? `${n.toUpperCase()} = ${fnv1(n)}`
        : 'Enter a name.';
    }
    function charIDToName(){
      const raw=document.getElementById('charID').value.trim();
      if(!/^-?\d+$/.test(raw)) return charIDOut.textContent='Enter a valid integer ID.';
      const target=parseInt(raw,10);
      const candidates=document.getElementById('charList').value
        .split('\n').map(x=>x.trim()).filter(Boolean);
      const hits=candidates.filter(x=>fnv1(x)===target);
      charIDOut.textContent=hits.length?hits.join('\n'):'No matches found.';
    }

    // Advanced picker toggle
    function toggleDropdown(){
      document.getElementById('pickerDropdown').classList.toggle('open');
    }

    // Hex → Tint ID
    function colNameToID(){
      const inp=document.getElementById('colName').value.trim();
      const name=inp.startsWith('#')?inp:'#'+inp;
      if(!/^#?[0-9A-Fa-f]{6}$/.test(name))
        return colNameOut.textContent='Enter #RRGGBB';
      const r=parseInt(name.slice(1,3),16),
            g=parseInt(name.slice(3,5),16),
            b=parseInt(name.slice(5,7),16);
      const u=(((255<<24)|(b<<16)|(g<<8)|r)>>>0);
      const s=(u&0x80000000)?u-0x100000000:u;
      colNameOut.textContent=`${name.toUpperCase()} = ${s}`;
    }

    // ID → Hex + Preview
    function colIDToHex(){
      const raw=document.getElementById('colID').value.trim();
      if(!/^-?\d+$/.test(raw))
        return colIDOut.textContent='Enter valid ID.';
      const signed=parseInt(raw,10),u=signed>>>0;
      const full=u.toString(16).toUpperCase().padStart(8,'0');
      const hex=full.slice(6,8)+full.slice(4,6)+full.slice(2,4);
      colIDOut.innerHTML=
        `${signed} = #${hex}\nPreview: <input id="swatch" class="small-color" type="color" disabled>`;
      document.getElementById('swatch').value=`#${hex}`;
    }

    // Eyedropper
    document.getElementById('imageLoader').addEventListener('change',function(e){
      const file=e.target.files[0],reader=new FileReader();
      reader.onload=ev=>{
        const img=new Image();
        img.onload=()=>{
          const c=document.getElementById('imageCanvas'),
                ctx=c.getContext('2d'),
                maxDim=document.getElementById('colName').clientWidth*0.66;
          let[w,h]=[img.width,img.height];
          const scale=Math.min(maxDim/w,maxDim/h,1);
          c.width=w*scale; c.height=h*scale;
          ctx.drawImage(img,0,0,c.width,c.height);
        };
        img.src=ev.target.result;
      };
      if(file)reader.readAsDataURL(file);
    });

    document.getElementById('imageCanvas').addEventListener('click',function(e){
      const ctx=this.getContext('2d'),rect=this.getBoundingClientRect(),
            x=e.clientX-rect.left,y=e.clientY-rect.top;
      const [r,g,b]=ctx.getImageData(x,y,1,1).data;
      const hex='#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
      document.getElementById('colName').value=hex;colNameToID();
    });
  </script>

</body>
</html>
